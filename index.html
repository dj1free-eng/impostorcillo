<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>El Impostorcillo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  * {
    box-sizing: border-box;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  }

  body {
    margin: 0;
    background: #050816;
    color: #f5f5f5;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }

  .app {
    width: 100%;
    max-width: 480px;
    padding: 16px;
  }

  .card {
    background: #111827;
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.4);
    position: relative; /* para poder colocar el bot√≥n Men√∫ flotando */
  }

  h1, h2, h3 {
    margin-top: 0;
    text-align: center;
  }

  h1 {
    font-size: 1.9rem;
    margin-bottom: 0.5rem;
  }

  p {
    line-height: 1.4;
  }

  label {
    display: block;
    margin: 10px 0 4px;
    font-size: 0.9rem;
    opacity: 0.9;
  }

  input, select {
    width: 100%;
    padding: 8px 10px;
    border-radius: 8px;
    border: none;
    font-size: 1rem;
    margin-bottom: 8px;
  }

  /* Botones normales del juego (Empezar, Volver, etc.) */
  button {
    width: 100%;
    padding: 12px;
    border-radius: 999px;
    border: none;
    font-size: 1rem;
    font-weight: 600;
    margin-top: 14px;
    cursor: pointer;
    background: linear-gradient(135deg, #22c55e, #16a34a);
    color: #fff;
    box-shadow: 0 6px 16px rgba(22, 163, 74, 0.5);
    transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.15s ease;
  }

  button.secondary {
    background: #374151;
    box-shadow: none;
  }

  button:active {
    transform: translateY(1px);
    box-shadow: 0 3px 8px rgba(22, 163, 74, 0.4);
    opacity: 0.9;
  }

  .small {
    font-size: 0.85rem;
    text-align: center;
    opacity: 0.8;
    margin-top: 12px;
  }

  .hidden {
    display: none;
  }

  .big-word {
    font-size: 1.8rem;
    text-align: center;
    margin: 20px 0;
    word-wrap: break-word;
  }

  .role-text {
    font-size: 1.1rem;
    text-align: center;
    margin-top: 10px;
    min-height: 3em;
  }

  .badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    background: #1f2937;
    color: #9ca3af;
    margin-bottom: 10px;
  }

  .center {
    text-align: center;
  }

  .highlight {
    color: #22c55e;
    font-weight: 700;
  }

  /* Bot√≥n peque√±o de Men√∫ (sin romper los dem√°s botones) */
  .menu-button {
    position: absolute;
    top: -14px;
    right: -14px;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    background: #374151;
    color: #e5e7eb;
    font-size: 0.7rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px !important;  /* evita el width:100% global */
  }

  .menu-button span {
    pointer-events: none;
  }

  .menu-button:hover {
    opacity: 1;
  }
  .role-image {
  display: flex;
  justify-content: center;
  margin-bottom: 10px;
}

.role-image img {
  width: 80%;
  max-width: 280px;
  border-radius: 20px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
}
  .title-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.title-icon {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
}
  .hero-illustration {
  display: flex;
  justify-content: center;
  margin-bottom: 16px;
}

.hero-illustration img {
  width: 80%;
  max-width: 260px;   /* l√≠mite para que no se dispare en m√≥vil */
  border-radius: 24px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}
  /* Contenedor de la carta */
.card-slider {
  width: 100%;
  height: 350px;
  background: #fff;
  border-radius: 24px;
  overflow: hidden;
  position: relative;
  touch-action: none;
  box-shadow: 0 12px 30px rgba(0,0,0,0.4);
}

/* Parte frontal (lo que se ve antes de deslizar) */
.card-front {
  position: absolute;
  top: 0;
  width: 100%;
  height: 100%;
  background: #fff;
  border-radius: 24px;
}

.card-front-img {
  width: 100%;
  height: 70%;
  object-fit: contain;
}

.slide-text {
  text-align: center;
  font-size: 1rem;
  margin-top: 4px;
  color: #444;
}

/* Parte trasera (el rol revelado) */
.card-back {
  position: absolute;
  top: 100%; /* escondida debajo */
  width: 100%;
  height: 100%;
  background: #fff;
  border-radius: 24px;
  padding: 20px;
  text-align: center;
}

/* T√≠tulo del rol */
#roleTitle {
  font-size: 1.5rem;
  margin-bottom: 10px;
}

/* Palabra */
#roleWord {
  font-size: 1.8rem;
  font-weight: bold;
}
</style>
</head>
<body>
  <div class="app">
<div class="card">
  <!-- Bot√≥n de men√∫ siempre visible -->
  <button class="menu-button" onclick="goToSetup()">
    <span>X</span>
  </button>
      <!-- Pantalla: Inicio -->
    <div id="screen-start">
  <div class="hero-illustration">
    <img src="img/impostor-hero.png" alt="Impostorcillo">
  </div>

  <h1>El Impostorcillo</h1>

  <p class="center">
    El juego social de deducci√≥n y enga√±o.<br>
    ¬°Intenta no parecer sospechoso!
  </p>

  <button onclick="goToSetup()">Nueva partida</button>
</div>

      <!-- Pantalla: Configuraci√≥n -->
      <div id="screen-setup" class="hidden">
<div class="title-row">
  <img src="img/impostor-icon.png" class="title-icon">
  <h2>Configuraci√≥n</h2>
</div>
       <label for="numPlayers">N√∫mero de jugadores</label>
<select id="numPlayers">
  <option value="3" selected>3 jugadores</option>
  <option value="4">4 jugadores</option>
  <option value="5">5 jugadores</option>
  <option value="6">6 jugadores</option>
  <option value="7">7 jugadores</option>
  <option value="8">8 jugadores</option>
  <option value="9">9 jugadores</option>
  <option value="10">10 jugadores</option>
  <option value="11">11 jugadores</option>
  <option value="12">12 jugadores</option>
</select>

        <label for="category">Categor√≠a</label>
        <select id="category">
          <option value="random">Aleatorio</option>
          <option value="comida">Comida</option>
          <option value="sitios">Lugares</option>
          <option value="peliculas">Pel√≠culas</option>
          <option value="objetos">Objetos</option>
        </select>

        <button onclick="startGame()">Empezar</button>
        <button class="secondary" onclick="backToStart()">Volver</button>

        <p class="small">Modo actual: 1 solo Impostorcillo, votos y acusaciones se hacen de viva voz.</p>
      </div>

      <!-- Pantalla: Rol de jugador -->
<div id="screen-role" class="hidden">
  
  <!-- Deslizable -->
  <div class="card-slider" id="cardSlider">

    <!-- Cara frontal (oculta rol) -->
    <div class="card-front">
      <img src="img/group-players.png" class="card-front-img">
      <p class="slide-text">Desliza hacia arriba üëÜ</p>
    </div>

    <!-- Cara trasera (rol revelado) -->
    <div class="card-back">
      <div class="role-box">
        <h3 id="roleTitle"></h3>
        <p id="roleWord"></p>
      </div>
    </div>

  </div>

  <button onclick="nextPlayer()" class="secondary hidden" id="nextPlayerBtn">
    Jugador siguiente
  </button>

</div>
      <!-- Pantalla: Debate / votaci√≥n -->
      <div id="screen-vote" class="hidden">
        <h2>Debatid y votad</h2>
        <p class="center">
          Todos hab√©is visto ya vuestro rol.<br/><br/>
          Ahora:
        </p>
        <ul style="font-size:0.95rem; line-height:1.5;">
          <li>Dad una pista cada uno, sin decir la palabra.</li>
          <li>Comentad y acusad a quien cre√°is que es el Impostorcillo.</li>
          <li>Haced una votaci√≥n final.</li>
        </ul>
        <p class="small">
          Cuando teng√°is decidido qui√©n es el Impostorcillo,<br/>
          pulsad el bot√≥n de abajo para ver el resultado real.
        </p>
        <button onclick="revealRoles()">Revelar resultado</button>
      </div>

      <!-- Pantalla: Revelaci√≥n final -->
      <div id="screen-reveal" class="hidden">
        <h2>Revelaci√≥n</h2>
        <p class="center">La palabra secreta era:</p>
        <div class="big-word" id="finalWord"></div>
        <p class="center">
          El Impostorcillo era el <span class="highlight" id="impostorPlayer"></span>.
        </p>
        <p class="small">
          ¬øHab√©is acertado? ¬øO el Impostorcillo os ha liado a todos? üòà
        </p>
        <button onclick="goToSetup()">Jugar otra vez</button>
        <button class="secondary" onclick="backToStart()">Salir al inicio</button>
      </div>
    </div>
  </div>

<script>
  // ==============================
  // BASE DE DATOS (JSON externo)
  // ==============================

  let WORDS_DB = [];
  // barajas por categor√≠a: "comida", "sitios", "peliculas", "objetos", "all" (para aleatorio)
  let decksByCategory = {};

  // Mezcla un array (Fisher-Yates)
  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  // Reinicia la baraja de UNA categor√≠a concreta (o "all")
  function resetCategoryDeck(categoryKey) {
    if (!WORDS_DB || WORDS_DB.length === 0) return;

    let words;
    if (categoryKey === 'all') {
      // baraja global con todas las palabras de tipo "word"
      words = WORDS_DB.filter(w => w.type === 'word');
    } else {
      // solo palabras de esa categor√≠a
      words = WORDS_DB.filter(w => w.type === 'word' && w.category === categoryKey);
    }

    decksByCategory[categoryKey] = [...words];
    shuffle(decksByCategory[categoryKey]);
    console.log(`Baraja de categor√≠a "${categoryKey}" reiniciada con`, decksByCategory[categoryKey].length, 'palabras.');
  }

  async function loadWordsDb() {
    try {
      const res = await fetch('data/words-es.json');
      if (!res.ok) throw new Error('No se pudo cargar data/words-es.json');
      const data = await res.json();
      if (Array.isArray(data)) {
        WORDS_DB = data;
        console.log('Base de datos de palabras cargada:', WORDS_DB.length, 'entradas');
        // Preparamos al menos la baraja global para "aleatorio"
        resetCategoryDeck('all');
      } else {
        console.error('El JSON de palabras no es un array');
      }
    } catch (err) {
      console.error('Error cargando base de datos de palabras:', err);
    }
  }

  // Cargamos la base nada m√°s abrir la p√°gina
  loadWordsDb();

  // ==============================
  // ESTADO DEL JUEGO
  // ==============================

  let gameState = {
    numPlayers: 0,
    currentPlayer: 1,
    secretWord: "",
    impostorIndex: 1,
    roleShown: false  // controla si el jugador ya ha visto su rol
  };

  // ==============================
  // UTILIDADES
  // ==============================

  function showScreen(id) {
    document.getElementById("screen-start").classList.add("hidden");
    document.getElementById("screen-setup").classList.add("hidden");
    document.getElementById("screen-role").classList.add("hidden");
    document.getElementById("screen-vote").classList.add("hidden");
    document.getElementById("screen-reveal").classList.add("hidden");
    document.getElementById(id).classList.remove("hidden");
  }

  function backToStart() {
    showScreen("screen-start");
  }

  function goToSetup() {
    showScreen("screen-setup");
  }

  function getRandomFromArray(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  // Devuelve una palabra de la baraja de la categor√≠a elegida,
  // sin repetir en esta sesi√≥n de juego.
  function getRandomWord(categoryKey) {
    // Si a√∫n no se ha cargado la base, devolvemos algo gen√©rico
    if (!WORDS_DB || WORDS_DB.length === 0) {
      const fallback = ["Impostor", "Misterio", "Secreto", "Sombra"];
      return getRandomFromArray(fallback);
    }

    // categoryKey de la UI: "comida", "sitios", "peliculas", "objetos", "random"
    // clave interna para la baraja:
    const deckKey = (categoryKey === 'random') ? 'all' : categoryKey;

    // Si no existe baraja para esa categor√≠a, la creamos
    if (!decksByCategory[deckKey]) {
      resetCategoryDeck(deckKey);
    }

    let deck = decksByCategory[deckKey] || [];

    // Si la baraja de esa categor√≠a est√° vac√≠a -> avisamos y la reiniciamos
    if (deck.length === 0) {
      if (deckKey === 'all') {
        alert("Se han usado todas las palabras disponibles. Se reinicia la baraja completa.");
      } else {
        alert(`Se han usado todas las palabras de la categor√≠a "${deckKey}". Se reinicia solo ese pack.`);
      }
      resetCategoryDeck(deckKey);
      deck = decksByCategory[deckKey] || [];
    }

    // Si A√öN as√≠ no hay palabras (por ejemplo, ninguna en el JSON para esa categor√≠a),
    // hacemos un fallback gen√©rico.
    if (deck.length === 0) {
      const fallback = ["Impostor", "Misterio", "Secreto", "Sombra"];
      return getRandomFromArray(fallback);
    }

    // Sacamos una carta al azar de la baraja (y la eliminamos para no repetir)
    const idx = Math.floor(Math.random() * deck.length);
    const chosen = deck.splice(idx, 1)[0];  // chosen es el objeto {id, text, ...}
    decksByCategory[deckKey] = deck;        // guardamos la baraja actualizada

    return chosen.text;
  }

  // ==============================
  // L√ìGICA PRINCIPAL
  // ==============================

  function startGame() {
    const numPlayersInput = document.getElementById("numPlayers");
    const categorySelect = document.getElementById("category");

    let n = parseInt(numPlayersInput.value, 10);
    if (isNaN(n) || n < 3) n = 3;
    if (n > 12) n = 12;

    const cat = categorySelect.value;

    gameState.numPlayers = n;
    gameState.currentPlayer = 1;
    gameState.secretWord = getRandomWord(cat);
    gameState.impostorIndex = Math.floor(Math.random() * n) + 1;
    gameState.roleShown = false;

    preparePlayerNeutralScreen();
    showScreen("screen-role");
  }

  // Pantalla neutra para el jugador actual (sin mostrar todav√≠a su rol)
  function preparePlayerNeutralScreen() {
    const { currentPlayer, numPlayers } = gameState;

    const badge = document.getElementById("playerBadge");
    const roleTitle = document.getElementById("roleTitle");
    const roleDescription = document.getElementById("roleDescription");
    const wordDisplay = document.getElementById("wordDisplay");
    const btnShowRole = document.getElementById("btnShowRole");
    const btnNextPlayer = document.getElementById("btnNextPlayer");

    gameState.roleShown = false;

    badge.textContent = `Jugador ${currentPlayer} de ${numPlayers}`;
    roleTitle.textContent = "Tu rol";
    roleDescription.innerHTML =
      'Cuando est√©s <strong>solo</strong> y nadie mire la pantalla,<br/>pulsa el bot√≥n de abajo para ver tu rol.';

    wordDisplay.textContent = "";
    btnShowRole.classList.remove("hidden");
    btnNextPlayer.classList.add("hidden");
  }

  // Se llama cuando el jugador pulsa "Mostrar rol"
  function showPlayerRole() {
    const { currentPlayer, impostorIndex, secretWord } = gameState;

    const roleTitle = document.getElementById("roleTitle");
    const roleDescription = document.getElementById("roleDescription");
    const wordDisplay = document.getElementById("wordDisplay");
    const btnShowRole = document.getElementById("btnShowRole");
    const btnNextPlayer = document.getElementById("btnNextPlayer");

    if (currentPlayer === impostorIndex) {
      roleTitle.textContent = "Eres el Impostorcillo üòà";
      roleDescription.textContent =
        "No conoces la palabra secreta. Escucha las pistas de los dem√°s, improvisa y finge que t√∫ tambi√©n la sabes.";
      wordDisplay.textContent = "???";
    } else {
      roleTitle.textContent = "Eres ciudadano üë§";
      roleDescription.textContent =
        "Conoces la palabra secreta. Da pistas sin decirla directamente, pero sin que te confundan con el Impostorcillo.";
      wordDisplay.textContent = secretWord;
    }

    gameState.roleShown = true;

    btnShowRole.classList.add("hidden");
    btnNextPlayer.classList.remove("hidden");
  }

  function nextPlayer() {
    if (!gameState.roleShown) return;

    if (gameState.currentPlayer < gameState.numPlayers) {
      gameState.currentPlayer += 1;
      preparePlayerNeutralScreen();
      showScreen("screen-role");
    } else {
      showScreen("screen-vote");
    }
  }

  function revealRoles() {
    document.getElementById("finalWord").textContent = gameState.secretWord;
    document.getElementById("impostorPlayer").textContent = `Jugador ${gameState.impostorIndex}`;
    showScreen("screen-reveal");
  }
  // --- DESLIZAR CARTA HACIA ARRIBA ---
const slider = document.getElementById("cardSlider");

let startY = 0;
let currentY = 0;
let dragging = false;

slider.addEventListener("touchstart", (e) => {
  startY = e.touches[0].clientY;
  dragging = true;
});

slider.addEventListener("touchmove", (e) => {
  if (!dragging) return;

  const touchY = e.touches[0].clientY;
  const deltaY = touchY - startY;

  // Solo permitimos mover hacia arriba
  if (deltaY < 0) {
    slider.style.transform = `translateY(${deltaY}px)`;
  }

  currentY = deltaY;
});

slider.addEventListener("touchend", () => {
  dragging = false;

  // Si se ha deslizado bastante hacia arriba, mostrar la parte del rol
  if (currentY < -120) {
    slider.style.transition = "transform 0.3s ease";
    slider.style.transform = "translateY(-100%)";

    // Mostrar bot√≥n para pasar al siguiente jugador
    document.getElementById("nextPlayerBtn").classList.remove("hidden");

  } else {
    // Volver a la posici√≥n original
    slider.style.transition = "transform 0.3s ease";
    slider.style.transform = "translateY(0)";
  }

  setTimeout(() => {
    slider.style.transition = "";
  }, 300);
});
</script>
</body>
</html>
